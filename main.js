(()=>{"use strict";var e={d:(t,o)=>{for(var r in o)e.o(o,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:o[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{we:()=>O,wb:()=>I,R3:()=>U,wd:()=>k,q_:()=>B,BU:()=>A,rC:()=>P});const t=document.querySelector(".profile__image"),o={baseUrl:"https://nomoreparties.co/v1/wff-cohort-5",headers:{authorization:"f019a5da-c98f-4c6e-b4b9-d7890c838afb","Content-Type":"application/json"}},r=(e,t)=>{const r=e.nextElementSibling;fetch(`${o.baseUrl}/cards/likes/${t}`,{method:e.classList.contains("card__like-button_is-active")?"DELETE":"PUT",headers:o.headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((t=>{r.textContent=t.likes.length,e.classList.toggle("card__like-button_is-active")})).catch((e=>{console.log(e)}))},n=e=>{document.querySelector(".popup__button").textContent=e?"Сохранение...":"Сохранить"},a=document.querySelectorAll(".popup"),s=document.querySelector(".popup_type_image"),c=s.querySelector(".popup__image"),p=s.querySelector(".popup__caption");let l=!1;const u=e=>{e.classList.add("popup__opened"),d()},i=e=>{e&&(e.classList.remove("popup__opened"),_())},d=()=>{l||(document.addEventListener("keydown",m),l=!0)},_=()=>{document.removeEventListener("keydown",m),l=!1},m=e=>{if("Escape"===e.key){const e=document.querySelector(".popup__opened");i(e)}},y=e=>{if(e.target.classList.contains("card__image")){const t=e.target.closest(".places__item").querySelector(".card__title").textContent,o=e.target.getAttribute("src");c.src=o,c.alt=t,p.textContent=t,u(s)}};a.forEach((e=>{e.addEventListener("click",(t=>{(t.target===e||t.target.classList.contains("popup__close"))&&i(e)}))}));const v=(e,t,o,r,n)=>{const a=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),s=a.querySelector(".card__image"),c=a.querySelector(".card__title"),p=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button"),i=l.nextElementSibling;return e.owner&&e.owner._id===n?(p.style.display="block",p.addEventListener("click",(()=>{e._id?(u(O),O.addEventListener("submit",(t=>{I(t,a,e._id)}))):console.log("Card ID is not available yet.")}))):p.style.display="none",e.likes&&e.likes.some((e=>e._id===n))&&l.classList.add("card__like-button_is-active"),l.addEventListener("click",(()=>{e._id?o(l,e._id):console.log("Card ID is not available yet.")})),s.addEventListener("click",(e=>r(e))),s.src=e.link,s.alt=e.name,c.textContent=e.name,i.textContent=e.likes?e.likes.length:0,a},b=(e,t,o,{inputErrorClass:r,errorClass:n})=>{const a=e.querySelector(`.${t.id}-error`);a&&(t.classList.add(r),a.textContent=o,a.classList.add(n))},h=(e,t,{inputErrorClass:o,errorClass:r})=>{const n=e.querySelector(`.${t.id}-error`);n&&(t.classList.remove(o),n.classList.remove(r),n.textContent="")},S=(e,t,{inactiveButtonClass:o})=>{(e=>e.some((e=>!e.validity.valid)))(e)?t.classList.add(o):t.classList.remove(o)},f=e=>{Array.from(document.querySelectorAll(e.formSelector)).forEach((t=>{t.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector)),r=e.querySelector(t.submitButtonSelector);S(o,r,t),o.forEach((n=>{n.addEventListener("input",(()=>{((e,t,o)=>{t.validity.valid?h(e,t,o):(b(e,t,t.validationMessage,o),""===t.value.trim()?b(e,t,t.dataset.error,o):t.validity.typeMismatch&&b(e,t,t.dataset.url,o))})(e,n,t),S(o,r,t)}))}))})(t,e)}))},g=(e,t)=>{const o=Array.from(e.querySelectorAll(t.inputSelector));o.forEach((o=>{h(e,o,t)}));const r=e.querySelector(t.submitButtonSelector);S(o,r,t)},q=document.forms.edit_profile,k=document.forms.new_place,C=document.querySelector(".popup_type_avatar"),E=document.querySelector(".profile__edit-button"),L=document.querySelector(".profile__add-button"),$=document.querySelector(".popup_type_edit"),j=q.querySelector(".popup__input_type_name"),x=q.querySelector(".popup__input_type_description"),w=document.querySelector(".popup__input_type_avatar_url"),P=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),B=document.querySelector(".places__list"),U=document.querySelector(".popup_type_new-card"),D=document.querySelector(".profile__image"),O=document.querySelector(".popup_type_delete_card");D.addEventListener("click",(()=>{u(C),g(C,H)})),E.addEventListener("click",(()=>{u($),g(q,N),T()})),L.addEventListener("click",(()=>{u(U),g(k,J)}));const T=()=>{j.value=P.textContent,x.value=A.textContent},I=(e,t,r)=>{e.preventDefault(),((e,t)=>{fetch(`${o.baseUrl}/cards/${t}`,{method:"DELETE",headers:o.headers}).then((t=>t.ok?e.remove():Promise.reject(`Ошибка: ${t.status}`))).catch((e=>{console.log(e)}))})(t,r),i(O)};C.addEventListener("submit",(e=>{var r;e.preventDefault(),n(!0),(r=w.value,fetch(`${o.baseUrl}/users/me/avatar`,{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:r})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{t.style.backgroundImage=`url(${e.avatar})`})).catch((e=>{console.log(e)}))).finally((()=>n(!1))),i(C)})),q.addEventListener("submit",(e=>{var t,r;e.preventDefault(),n(!0),(t=j.value,r=x.value,fetch(`${o.baseUrl}/users/me`,{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:r})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>{P.textContent=e.name,A.textContent=e.about})).catch((e=>{console.log(e)}))).finally((()=>n(!1))),i($)})),k.addEventListener("submit",(e=>{e.preventDefault(),n(!0);const t=document.querySelector(".popup__input_type_card-name"),a=document.querySelector(".popup__input_type_url"),s=t.value,c=a.value,p=v({name:s,link:c},0,r,y);var l,u;B.prepend(p),(l=s,u=c,fetch(`${o.baseUrl}/cards`,{method:"POST",headers:o.headers,body:JSON.stringify({name:l,link:u,likes:0})}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).catch((e=>{console.log(e)}))).finally((()=>n(!1))),k.reset(),i(U)}));const N={formSelector:".popup_type_edit .popup__form",inputSelector:".popup_type_edit .popup__input",submitButtonSelector:".popup_type_edit .popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},J={formSelector:".popup_type_new-card .popup__form",inputSelector:".popup_type_new-card .popup__input",submitButtonSelector:".popup_type_new-card .popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},H={formSelector:".popup_type_avatar .popup__form",inputSelector:".popup_type_avatar .popup__input",submitButtonSelector:".popup_type_avatar .popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};Promise.all([fetch(`${o.baseUrl}/users/me`,{headers:o.headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).then((e=>(P.textContent=e.name,A.textContent=e.about,t.style.backgroundImage=`url(${e.avatar})`,e))).catch((e=>{console.log(e)})),fetch(`${o.baseUrl}/cards`,{headers:o.headers}).then((e=>e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`))).catch((e=>{console.log(e)}))]).then((([e,t])=>{var o,n;o=t,n=e._id,o.forEach((e=>{const t=v(e,0,r,y,n);B.append(t)}))})).catch((e=>{console.log(e)})),f(N),f(J),f(H),g(q,N),g(k,J),g(C,H)})();