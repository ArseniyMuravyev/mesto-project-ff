(()=>{"use strict";function e(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}const t=e=>console.log(e),r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-5",headers:{authorization:"f019a5da-c98f-4c6e-b4b9-d7890c838afb","Content-Type":"application/json"}},o=(e,t,r,o,a)=>{const n=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),c=n.querySelector(".card__image"),s=n.querySelector(".card__title"),l=n.querySelector(".card__delete-button"),i=n.querySelector(".card__like-button"),u=i.closest(".card").querySelector(".card__like-amount");return e.owner&&e.owner._id===a?(l.style.display="block",l.addEventListener("click",(()=>t(n,e._id)))):l.style.display="none",e.likes&&e.likes.some((e=>e._id===a))&&i.classList.add("card__like-button_is-active"),i.addEventListener("click",(()=>r(i,u,e._id,a))),c.addEventListener("click",(e=>o(e))),c.src=e.link,c.alt=e.name,s.textContent=e.name,u.textContent=e.likes?e.likes.length:0,n},a=(o,a)=>{((t,o)=>fetch(`${r.baseUrl}/cards/${o}`,{method:"DELETE",headers:r.headers}).then(e))(0,a).then((()=>o.remove())).catch(t)},n=(o,a,n,c)=>{((t,o,a)=>fetch(`${r.baseUrl}/cards/likes/${o}`,{method:t.classList.contains("card__like-button_is-active")?"DELETE":"PUT",headers:r.headers}).then(e))(o,n).then((e=>{a.textContent=e.likes.length,o.classList.toggle("card__like-button_is-active")})).catch(t)},c=document.querySelectorAll(".popup");let s=!1;const l=e=>{e.classList.add("popup__opened"),u()},i=e=>{e&&(e.classList.remove("popup__opened"),d())},u=()=>{s||(document.addEventListener("keydown",p),s=!0)},d=()=>{document.removeEventListener("keydown",p),s=!1},p=e=>{if("Escape"===e.key){const e=document.querySelector(".popup__opened");i(e)}};c.forEach((e=>{e.addEventListener("click",(t=>{(t.target===e||t.target.classList.contains("popup__close"))&&i(e)}))}));const _=(e,t,r,{inputErrorClass:o,errorClass:a})=>{const n=e.querySelector(`.${t.id}-error`);n&&(t.classList.add(o),n.textContent=r,n.classList.add(a))},m=(e,t,{inputErrorClass:r,errorClass:o})=>{const a=e.querySelector(`.${t.id}-error`);a&&(t.classList.remove(r),a.classList.remove(o),a.textContent="")},y=(e,t,{inactiveButtonClass:r})=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.setAttribute("disabled",!0),t.classList.add(r)):(t.removeAttribute("disabled"),t.classList.remove(r))},h=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector));r.forEach((r=>{m(e,r,t)}));const o=e.querySelector(t.submitButtonSelector);y(r,o,t)},v=document.forms.edit_profile,S=document.forms.new_place,f=document.querySelector(".popup_type_avatar"),b=document.querySelector(".profile__edit-button"),q=document.querySelector(".profile__add-button"),E=document.querySelector(".popup_type_edit"),L=v.querySelector(".popup__input_type_name"),k=v.querySelector(".popup__input_type_description"),g=document.querySelector(".popup__input_type_avatar_url"),C=document.querySelector(".profile__title"),x=document.querySelector(".profile__description"),$=document.querySelector(".places__list"),A=document.querySelector(".popup_type_new-card"),U=document.querySelector(".profile__image"),w=(document.querySelector(".popup_type_delete_card"),document.querySelector(".popup__input_type_card-name")),T=document.querySelector(".popup__input_type_url"),D=document.querySelector(".popup_type_image"),P=D.querySelector(".popup__image"),B=D.querySelector(".popup__caption"),N=document.querySelector(".profile__image");let O;U.addEventListener("click",(()=>{l(f),h(f,H)})),b.addEventListener("click",(()=>{l(E),h(v,H),j()})),q.addEventListener("click",(()=>{l(A),h(S,H)}));const j=()=>{L.value=C.textContent,k.value=x.textContent},J=e=>{if(e.target.classList.contains("card__image")){const t=e.target.closest(".places__item").querySelector(".card__title").textContent;P.src=e.target.getAttribute("src"),P.alt=t,B.textContent=t,l(D)}};f.addEventListener("submit",(o=>{var a;o.preventDefault(),I(!0),(a=g.value,fetch(`${r.baseUrl}/users/me/avatar`,{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:a})}).then(e)).then((e=>{N.style.backgroundImage=`url(${e.avatar})`})).then((()=>i(f))).catch(t).finally((()=>I(!1)))})),v.addEventListener("submit",(o=>{var a,n;o.preventDefault(),I(!0),(a=L.value,n=k.value,fetch(`${r.baseUrl}/users/me`,{method:"PATCH",headers:r.headers,body:JSON.stringify({name:a,about:n})}).then(e)).then((e=>{C.textContent=e.name,x.textContent=e.about})).then((()=>i(E))).catch(t).finally((()=>I(!1)))})),S.addEventListener("submit",(c=>{var s,l;c.preventDefault(),I(!0),(s=w.value,l=T.value,fetch(`${r.baseUrl}/cards`,{method:"POST",headers:r.headers,body:JSON.stringify({name:s,link:l,likes:0})}).then(e)).then((e=>{const t=o(e,a,n,J,O);$.prepend(t)})).then((()=>S.reset())).then((()=>i(A))).catch(t).finally((()=>I(!1)))}));const H={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},I=e=>{document.querySelectorAll(".popup__button").forEach((t=>t.textContent=e?"Сохранение...":"Сохранить"))};var M;Promise.all([fetch(`${r.baseUrl}/users/me`,{headers:r.headers}).then(e),fetch(`${r.baseUrl}/cards`,{headers:r.headers}).then(e)]).then((([e,t])=>{O=e._id,C.textContent=e.name,x.textContent=e.about,N.style.backgroundImage=`url(${e.avatar})`,((e,t)=>{e.forEach((e=>{const r=o(e,a,n,J,t);$.append(r)}))})(t,O)})).catch(t),M=H,Array.from(document.querySelectorAll(M.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);y(r,o,t),r.forEach((a=>{a.addEventListener("input",(()=>{((e,t,r)=>{t.validity.valid?m(e,t,r):(_(e,t,t.validationMessage,r),""===t.value.trim()?_(e,t,t.dataset.error,r):t.validity.typeMismatch&&_(e,t,t.dataset.url,r))})(e,a,t),y(r,o,t)}))}))})(e,M)}))})();