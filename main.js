(()=>{"use strict";function e(e){return e.ok?e.json():Promise.reject(`Ошибка: ${e.status}`)}const t=e=>console.log(e),r={baseUrl:"https://nomoreparties.co/v1/wff-cohort-5",headers:{authorization:"f019a5da-c98f-4c6e-b4b9-d7890c838afb","Content-Type":"application/json"}},o=()=>fetch(`${r.baseUrl}/users/me`,{headers:r.headers}).then(e),a=(t,o,a)=>fetch(`${r.baseUrl}/cards/likes/${o}`,{method:t.classList.contains("card__like-button_is-active")?"DELETE":"PUT",headers:r.headers}).then(e),n=(e,t)=>fetch(`${r.baseUrl}/cards/${t}`,{method:"DELETE",headers:r.headers}).then((t=>t.ok?e.remove():Promise.reject(`Ошибка: ${t.status}`))),c=e=>{document.querySelectorAll(".popup__button").forEach((t=>t.textContent=e?"Сохранение...":"Сохранить"))},s=(e,r,o,a,n)=>{const c=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),s=c.querySelector(".card__image"),l=c.querySelector(".card__title"),i=c.querySelector(".card__delete-button"),u=c.querySelector(".card__like-button"),d=u.closest(".card").querySelector(".card__like-amount");return e.owner&&e.owner._id===n?(i.style.display="block",i.addEventListener("click",(()=>r(c,e._id)))):i.style.display="none",e.likes&&e.likes.some((e=>e._id===n))&&u.classList.add("card__like-button_is-active"),u.addEventListener("click",(()=>{o(u,e._id,n).then((e=>{d.textContent=e.likes.length,u.classList.toggle("card__like-button_is-active")})).catch(t)})),s.addEventListener("click",(e=>a(e))),s.src=e.link,s.alt=e.name,l.textContent=e.name,d.textContent=e.likes?e.likes.length:0,c},l=document.querySelectorAll(".popup");let i=!1;const u=e=>{e.classList.add("popup__opened"),p()},d=e=>{e&&(e.classList.remove("popup__opened"),_())},p=()=>{i||(document.addEventListener("keydown",m),i=!0)},_=()=>{document.removeEventListener("keydown",m),i=!1},m=e=>{if("Escape"===e.key){const e=document.querySelector(".popup__opened");d(e)}};l.forEach((e=>{e.addEventListener("click",(t=>{(t.target===e||t.target.classList.contains("popup__close"))&&d(e)}))}));const y=(e,t,r,{inputErrorClass:o,errorClass:a})=>{const n=e.querySelector(`.${t.id}-error`);n&&(t.classList.add(o),n.textContent=r,n.classList.add(a))},h=(e,t,{inputErrorClass:r,errorClass:o})=>{const a=e.querySelector(`.${t.id}-error`);a&&(t.classList.remove(r),a.classList.remove(o),a.textContent="")},v=(e,t,{inactiveButtonClass:r})=>{(e=>e.some((e=>!e.validity.valid)))(e)?(t.setAttribute("disabled",!0),t.classList.add(r)):(t.removeAttribute("disabled"),t.classList.remove(r))},S=(e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector));r.forEach((r=>{h(e,r,t)}));const o=e.querySelector(t.submitButtonSelector);v(r,o,t)},f=document.forms.edit_profile,b=document.forms.new_place,q=document.querySelector(".popup_type_avatar"),E=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-button"),L=document.querySelector(".popup_type_edit"),g=f.querySelector(".popup__input_type_name"),C=f.querySelector(".popup__input_type_description"),$=document.querySelector(".popup__input_type_avatar_url"),x=document.querySelector(".profile__title"),A=document.querySelector(".profile__description"),U=document.querySelector(".places__list"),w=document.querySelector(".popup_type_new-card"),P=document.querySelector(".profile__image"),T=(document.querySelector(".popup_type_delete_card"),document.querySelector(".popup__input_type_card-name")),D=document.querySelector(".popup__input_type_url"),B=document.querySelector(".popup_type_image"),j=B.querySelector(".popup__image"),N=B.querySelector(".popup__caption"),O=document.querySelector(".profile__image");let J;P.addEventListener("click",(()=>{u(q),S(q,M)})),E.addEventListener("click",(()=>{u(L),S(f,M),H()})),k.addEventListener("click",(()=>{u(w),S(b,M)}));const H=()=>{g.value=x.textContent,C.value=A.textContent},I=e=>{if(e.target.classList.contains("card__image")){const t=e.target.closest(".places__item").querySelector(".card__title").textContent;j.src=e.target.getAttribute("src"),j.alt=t,N.textContent=t,u(B)}};q.addEventListener("submit",(o=>{var a;o.preventDefault(),c(!0),(a=$.value,fetch(`${r.baseUrl}/users/me/avatar`,{method:"PATCH",headers:r.headers,body:JSON.stringify({avatar:a})}).then(e)).then((e=>{O.style.backgroundImage=`url(${e.avatar})`})).then((()=>d(q))).catch(t).finally((()=>c(!1)))})),f.addEventListener("submit",(o=>{var a,n;o.preventDefault(),c(!0),(a=g.value,n=C.value,fetch(`${r.baseUrl}/users/me`,{method:"PATCH",headers:r.headers,body:JSON.stringify({name:a,about:n})}).then(e)).then((e=>{x.textContent=e.name,A.textContent=e.about})).then((()=>d(L))).catch(t).finally((()=>c(!1)))})),b.addEventListener("submit",(o=>{var l,i;o.preventDefault(),c(!0),(l=T.value,i=D.value,fetch(`${r.baseUrl}/cards`,{method:"POST",headers:r.headers,body:JSON.stringify({name:l,link:i,likes:0})}).then(e)).then((e=>{const t=s(e,n,a,I,J);U.prepend(t)})).then((()=>b.reset())).then((()=>d(w))).catch(t).finally((()=>c(!1)))}));const M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};var z;Promise.all([o(),fetch(`${r.baseUrl}/cards`,{headers:r.headers}).then(e)]).then((([e,t])=>{var r,o;r=t,o=e._id,r.forEach((e=>{const t=s(e,n,a,I,o);U.append(t)}))})).catch(t),o().then((e=>{J=e._id,x.textContent=e.name,A.textContent=e.about,O.style.backgroundImage=`url(${e.avatar})`})).catch(t),z=M,Array.from(document.querySelectorAll(z.formSelector)).forEach((e=>{e.addEventListener("submit",(e=>{e.preventDefault()})),((e,t)=>{const r=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);v(r,o,t),r.forEach((a=>{a.addEventListener("input",(()=>{((e,t,r)=>{t.validity.valid?h(e,t,r):(y(e,t,t.validationMessage,r),""===t.value.trim()?y(e,t,t.dataset.error,r):t.validity.typeMismatch&&y(e,t,t.dataset.url,r))})(e,a,t),v(r,o,t)}))}))})(e,z)}))})();